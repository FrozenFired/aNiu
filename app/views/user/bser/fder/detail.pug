extends ../aalayout/layout

block content
	.m-5
		.row
			.col-12
				h3 #{fder.code} &nbsp; #{fder.nome} &nbsp; #{fder.tel}
		.row
			each machin in fder.machins
				-a;
				each macfir in machin.macfirs
					-a;
					table.table.table-border.text-center.mt-5
						tr(class=txtSatus)
							th(width="10%") #{moment(machin.ctAt).format('MM/DD/YYYY')}
							th(width="8%") #{moment(machin.fnAt).format('MM/DD/YYYY')}
							th(width="5%") 生产
							th(colspan=machin.sizes.length, width="25%")
								a.btn.btn-link(href="/bsMachin/"+machin._id) #{machin.code}
							th.bg-secondary(width="2%")
							th(colspan=machin.sizes.length)
								.row
									.col-6
									.col-6
										if machin.status == 5
											-a;
											span 正在处理...
										else
											span 已经完成
						tr.bg-light
							th 样品型号
							th 工厂名称
							th 颜色
							each size in machin.sizes
								-a;
								th #{Conf.sizes[size]}
							th.bg-secondary
							each size in machin.sizes
								-a;
								th #{Conf.sizes[size]}
						if macfir.pdfir.semi == 1
							-a;
							tr
								th: a(href="/bsProduct/"+macfir.pdfir._id) #{macfir.pdfir.code}
								th #{machin.fder.nome}
								th.bg-light 半成品
								each size in machin.sizes
									-let quot = '';
									each macsez in macfir.macsezs
										if macsez.size == size
											- quot = macsez.quot;
											- break;
									td #{quot}
								td.bg-secondary
								each size in machin.sizes
									-let less = '';
									-let stock = '';
									-let ship = '';
									-let macsezId = '';
									each macsez in macfir.macsezs
										if macsez.size == size
											- macsezId = macsez._id;
											- stock = parseInt(macsez.pdsez.stock);
											- ship = parseInt(macsez.ship);
											- less = parseInt(macsez.quot) - ship;
											- break;
									td 
										if macsezId

											span.text-info #{ship}
												//- span &nbsp; /  
												//- span.text-warning #{stock}
						else
							- let i = 0, k = 0;
							each macsec in macfir.macsecs
								- i++;
								tr
									if i==1
										-a;
										th: a(href="/bsProduct/"+macfir.pdfir._id) #{macfir.pdfir.code}
										th #{machin.fder.nome}
									else
										th
										th
									th.bg-light #{macsec.pdsec.color}
									each size in machin.sizes
										-let quot = '';
										each macthd in macsec.macthds
											if macthd.size == size
												- quot = macthd.quot;
												- break;
										td #{quot}
									td.bg-secondary
									each size in machin.sizes
										-let less = '';
										-let stock = '';
										-let ship = '';
										-let macthdId = '';
										each macthd in macsec.macthds
											if macthd.size == size
												- macthdId = macthd._id;
												- stock = parseInt(macthd.pdthd.stock);
												- ship = parseInt(macthd.ship);
												- less = parseInt(macthd.quot) - ship;
												- break;
										td 
											if macthdId

												span.text-info #{ship}
													//- span &nbsp; /  
													//- span.text-warning #{stock}
